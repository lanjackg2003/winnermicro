


ARM Macro Assembler    Page 1 


    1 00000000         ;/*
    2 00000000         ;    FreeRTOS V7.0.2 - Copyright (C) 2011 Real Time Engi
                       neers Ltd.
    3 00000000         ; 
    4 00000000         ;
    5 00000000         ;    ***************************************************
                       ************************
    6 00000000         ;     *                                                 
                                             *
    7 00000000         ;     *    FreeRTOS tutorial books are available in pdf 
                       and paperback.        *
    8 00000000         ;     *    Complete, revised, and edited pdf reference m
                       anuals are also       *
    9 00000000         ;     *    available.                                   
                                             *
   10 00000000         ;     *                                                 
                                             *
   11 00000000         ;     *    Purchasing FreeRTOS documentation will not on
                       ly help you, by       *
   12 00000000         ;     *    ensuring you get running as quickly as possib
                       le and with an        *
   13 00000000         ;     *    in-depth knowledge of how to use FreeRTOS, it
                        will also help       *
   14 00000000         ;     *    the FreeRTOS project to continue with its mis
                       sion of providing     *
   15 00000000         ;     *    professional grade, cross platform, de facto 
                       standard solutions    *
   16 00000000         ;     *    for microcontrollers - completely free of cha
                       rge!                  *
   17 00000000         ;     *                                                 
                                             *
   18 00000000         ;     *    >>> See http://www.FreeRTOS.org/Documentation
                        for details. <<<     *
   19 00000000         ;     *                                                 
                                             *
   20 00000000         ;     *    Thank you for using FreeRTOS, and thank you f
                       or your support!      *
   21 00000000         ;     *                                                 
                                             *
   22 00000000         ;    ***************************************************
                       ************************
   23 00000000         ;
   24 00000000         ;
   25 00000000         ;    This file is part of the FreeRTOS distribution.
   26 00000000         ;
   27 00000000         ;    FreeRTOS is free software; you can redistribute it 
                       and/or modify it under
   28 00000000         ;    the terms of the GNU General Public License (versio
                       n 2) as published by the
   29 00000000         ;    Free Software Foundation AND MODIFIED BY the FreeRT
                       OS exception.
   30 00000000         ;    >>>NOTE<<< The modification to the GPL is included 
                       to allow you to
   31 00000000         ;    distribute a combined work that includes FreeRTOS w
                       ithout being obliged to
   32 00000000         ;    provide the source code for proprietary components 
                       outside of the FreeRTOS
   33 00000000         ;    kernel.  FreeRTOS is distributed in the hope that i
                       t will be useful, but



ARM Macro Assembler    Page 2 


   34 00000000         ;    WITHOUT ANY WARRANTY; without even the implied warr
                       anty of MERCHANTABILITY
   35 00000000         ;    or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU G
                       eneral Public License for
   36 00000000         ;    more details. You should have received a copy of th
                       e GNU General Public
   37 00000000         ;    License and the FreeRTOS license exception along wi
                       th FreeRTOS; if not it
   38 00000000         ;    can be viewed here: http://www.freertos.org/a00114.
                       html and also obtained
   39 00000000         ;    by writing to Richard Barry, contact details for wh
                       om are available on the
   40 00000000         ;    FreeRTOS WEB site.
   41 00000000         ;
   42 00000000         ;    1 tab == 4 spaces!
   43 00000000         ;
   44 00000000         ;    http://www.FreeRTOS.org - Documentation, latest inf
                       ormation, license and
   45 00000000         ;    contact details.
   46 00000000         ;
   47 00000000         ;    http://www.SafeRTOS.com - A version that is certifi
                       ed for use in safety
   48 00000000         ;    critical systems.
   49 00000000         ;
   50 00000000         ;    http://www.OpenRTOS.com - Commercial support, devel
                       opment, porting,
   51 00000000         ;    licensing and training services.
   52 00000000         ;*/
   53 00000000         
   54 00000000                 INCLUDE          wm_config.inc
    1 00000000         ;__TLS_OS_UCOS EQU 1  ;¶þÑ¡Ò»
    2 00000000 00000001 
                       __TLS_OS_FREERTOS
                               EQU              1
    3 00000000                 END
   55 00000000                 INCLUDE          portmacro.inc
    1 00000000         ;/*
    2 00000000         ;    FreeRTOS V7.0.2 - Copyright (C) 2011 Real Time Engi
                       neers Ltd.
    3 00000000         ; 
    4 00000000         ;
    5 00000000         ;    ***************************************************
                       ************************
    6 00000000         ;     *                                                 
                                             *
    7 00000000         ;     *    FreeRTOS tutorial books are available in pdf 
                       and paperback.        *
    8 00000000         ;     *    Complete, revised, and edited pdf reference m
                       anuals are also       *
    9 00000000         ;     *    available.                                   
                                             *
   10 00000000         ;     *                                                 
                                             *
   11 00000000         ;     *    Purchasing FreeRTOS documentation will not on
                       ly help you, by       *
   12 00000000         ;     *    ensuring you get running as quickly as possib
                       le and with an        *
   13 00000000         ;     *    in-depth knowledge of how to use FreeRTOS, it
                        will also help       *



ARM Macro Assembler    Page 3 


   14 00000000         ;     *    the FreeRTOS project to continue with its mis
                       sion of providing     *
   15 00000000         ;     *    professional grade, cross platform, de facto 
                       standard solutions    *
   16 00000000         ;     *    for microcontrollers - completely free of cha
                       rge!                  *
   17 00000000         ;     *                                                 
                                             *
   18 00000000         ;     *    >>> See http://www.FreeRTOS.org/Documentation
                        for details. <<<     *
   19 00000000         ;     *                                                 
                                             *
   20 00000000         ;     *    Thank you for using FreeRTOS, and thank you f
                       or your support!      *
   21 00000000         ;     *                                                 
                                             *
   22 00000000         ;    ***************************************************
                       ************************
   23 00000000         ;
   24 00000000         ;
   25 00000000         ;    This file is part of the FreeRTOS distribution.
   26 00000000         ;
   27 00000000         ;    FreeRTOS is free software; you can redistribute it 
                       and/or modify it under
   28 00000000         ;    the terms of the GNU General Public License (versio
                       n 2) as published by the
   29 00000000         ;    Free Software Foundation AND MODIFIED BY the FreeRT
                       OS exception.
   30 00000000         ;    >>>NOTE<<< The modification to the GPL is included 
                       to allow you to
   31 00000000         ;    distribute a combined work that includes FreeRTOS w
                       ithout being obliged to
   32 00000000         ;    provide the source code for proprietary components 
                       outside of the FreeRTOS
   33 00000000         ;    kernel.  FreeRTOS is distributed in the hope that i
                       t will be useful, but
   34 00000000         ;    WITHOUT ANY WARRANTY; without even the implied warr
                       anty of MERCHANTABILITY
   35 00000000         ;    or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU G
                       eneral Public License for
   36 00000000         ;    more details. You should have received a copy of th
                       e GNU General Public
   37 00000000         ;    License and the FreeRTOS license exception along wi
                       th FreeRTOS; if not it
   38 00000000         ;    can be viewed here: http://www.freertos.org/a00114.
                       html and also obtained
   39 00000000         ;    by writing to Richard Barry, contact details for wh
                       om are available on the
   40 00000000         ;    FreeRTOS WEB site.
   41 00000000         ;
   42 00000000         ;    1 tab == 4 spaces!
   43 00000000         ;
   44 00000000         ;    http://www.FreeRTOS.org - Documentation, latest inf
                       ormation, license and
   45 00000000         ;    contact details.
   46 00000000         ;
   47 00000000         ;    http://www.SafeRTOS.com - A version that is certifi
                       ed for use in safety
   48 00000000         ;    critical systems.



ARM Macro Assembler    Page 4 


   49 00000000         ;
   50 00000000         ;    http://www.OpenRTOS.com - Commercial support, devel
                       opment, porting,
   51 00000000         ;    licensing and training services.
   52 00000000         ;*/
   53 00000000         
   54 00000000                 IMPORT           ulCriticalNesting ;
   55 00000000                 IMPORT           pxCurrentTCB ;
   56 00000000         
   57 00000000         
   58 00000000                 MACRO
   59 00000000                 portRESTORE_CONTEXT
   60 00000000         
   61 00000000                 LDR              R0, =pxCurrentTCB ; Set the LR 
                                                            to the task stack. 
                                                             The location was..
                                                            .
   62 00000000                 LDR              R0, [R0]    ; ... stored in pxC
                                                            urrentTCB
   63 00000000                 LDR              LR, [R0]
   64 00000000         
   65 00000000                 LDR              R0, =ulCriticalNesting ; The cr
                                                            itical nesting dept
                                                            h is the first item
                                                             on... 
   66 00000000                 LDMFD            LR!, {R1}   ; ...the stack.  Lo
                                                            ad it into the ulCr
                                                            iticalNesting var.
   67 00000000                 STR              R1, [R0]    ;
   68 00000000         
   69 00000000                 LDMFD            LR!, {R0}   ; Get the SPSR from
                                                             the stack.
   70 00000000                 MSR              SPSR_cxsf, R0 ;
   71 00000000         
   72 00000000                 LDMFD            LR, {R0-R14}^ ; Restore all sys
                                                            tem mode registers 
                                                            for the task.
   73 00000000                 NOP                          ;
   74 00000000         
   75 00000000                 LDR              LR, [LR, #+60] ; Restore the re
                                                            turn address
   76 00000000         
   77 00000000         ; And return - correcting the offset in the LR to obtain
                        ...
   78 00000000                 SUBS             PC, LR, #4  ; ...the correct ad
                                                            dress.
   79 00000000         
   80 00000000                 MEND
   81 00000000         
   82 00000000         ; /*****************************************************
                       *****************/
   83 00000000         
   84 00000000                 MACRO
   85 00000000                 portSAVE_CONTEXT
   86 00000000         
   87 00000000                 STMDB            SP!, {R0}   ; Store R0 first as
                                                             we need to use it.
                                                            
   88 00000000         



ARM Macro Assembler    Page 5 


   89 00000000                 STMDB            SP,{SP}^    ; Set R0 to point t
                                                            o the task stack po
                                                            inter.
   90 00000000                 NOP                          ;
   91 00000000                 SUB              SP, SP, #4  ;
   92 00000000                 LDMIA            SP!,{R0}    ;
   93 00000000         
   94 00000000                 STMDB            R0!, {LR}   ; Push the return a
                                                            ddress onto the sta
                                                            ck.
   95 00000000                 MOV              LR, R0      ; Now we have saved
                                                             LR we can use it i
                                                            nstead of R0.
   96 00000000                 LDMIA            SP!, {R0}   ; Pop R0 so we can 
                                                            save it onto the sy
                                                            stem mode stack.
   97 00000000         
   98 00000000                 STMDB            LR,{R0-LR}^ ; Push all the syst
                                                            em mode registers o
                                                            nto the task stack.
                                                            
   99 00000000                 NOP                          ;
  100 00000000                 SUB              LR, LR, #60 ;
  101 00000000         
  102 00000000                 MRS              R0, SPSR    ; Push the SPSR ont
                                                            o the task stack.
  103 00000000                 STMDB            LR!, {R0}   ;
  104 00000000         
  105 00000000                 LDR              R0, =ulCriticalNesting ;
  106 00000000                 LDR              R0, [R0]    ;
  107 00000000                 STMDB            LR!, {R0}   ;
  108 00000000         
  109 00000000                 LDR              R0, =pxCurrentTCB ; Store the n
                                                            ew top of stack for
                                                             the task.
  110 00000000                 LDR              R1, [R0]    ;    
  111 00000000                 STR              LR, [R1]    ;
  112 00000000         
  113 00000000                 MEND
  114 00000000         
  115 00000000                 END
   56 00000000                 IF               :DEF: __TLS_OS_FREERTOS
   57 00000000                 IMPORT           vTaskSwitchContext
   58 00000000                 IMPORT           vTaskIncrementTick
   59 00000000                 IMPORT           freeRtos_irq_isr_handler
   60 00000000         
   61 00000000                 EXPORT           vPortYieldProcessor
   62 00000000                 EXPORT           vPortStartFirstTask
   63 00000000                 EXPORT           vPreemptiveTick
   64 00000000                 EXPORT           vPortYield
   65 00000000                 EXPORT           freeRtosirqHandler
   66 00000000                 EXPORT           portDISABLE_INTERRUPTS
   67 00000000                 EXPORT           portENABLE_INTERRUPTS
   68 00000000         ;EXPORT portRESTORE_CONTEXT
   69 00000000         ;EXPORT portSAVE_CONTEXT
   70 00000000         
   71 00000000         
   72 00000000         
   73 00000000 FFFFF030 



ARM Macro Assembler    Page 6 


                       VICVECTADDR
                               EQU              0xFFFFF030
   74 00000000 E0004000 
                       T0IR    EQU              0xE0004000
   75 00000000 00000001 
                       T0MATCHBIT
                               EQU              0x00000001
   76 00000000         
   77 00000000                 ARM
   78 00000000                 AREA             PORT_ASM, CODE, READONLY
   79 00000000         
   80 00000000         
   81 00000000         
   82 00000000         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;
   83 00000000         ; Starting the first task is done by just restoring the 
                       context 
   84 00000000         ; setup by pxPortInitialiseStack
   85 00000000         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;
   86 00000000         vPortStartFirstTask
   87 00000000         
   88 00000000                 PRESERVE8
   89 00000000         
   90 00000000                 portRESTORE_CONTEXT
   60 00000000         
   61 00000000 E59F0210        LDR              R0, =pxCurrentTCB ; Set the LR 
                                                            to the task stack. 
                                                             The location was..
                                                            .
   62 00000004 E5900000        LDR              R0, [R0]    ; ... stored in pxC
                                                            urrentTCB
   63 00000008 E590E000        LDR              LR, [R0]
   64 0000000C         
   65 0000000C E59F0208        LDR              R0, =ulCriticalNesting ; The cr
                                                            itical nesting dept
                                                            h is the first item
                                                             on... 
   66 00000010 E8BE0002        LDMFD            LR!, {R1}   ; ...the stack.  Lo
                                                            ad it into the ulCr
                                                            iticalNesting var.
   67 00000014 E5801000        STR              R1, [R0]    ;
   68 00000018         
   69 00000018 E8BE0001        LDMFD            LR!, {R0}   ; Get the SPSR from
                                                             the stack.
   70 0000001C E16FF000        MSR              SPSR_cxsf, R0 ;
   71 00000020         
   72 00000020 E8DE7FFF        LDMFD            LR, {R0-R14}^ ; Restore all sys
                                                            tem mode registers 
                                                            for the task.
   73 00000024 E1A00000        NOP                          ;
   74 00000028         
   75 00000028 E59EE03C        LDR              LR, [LR, #+60] ; Restore the re
                                                            turn address
   76 0000002C         
   77 0000002C         ; And return - correcting the offset in the LR to obtain
                        ...
   78 0000002C E25EF004        SUBS             PC, LR, #4  ; ...the correct ad
                                                            dress.



ARM Macro Assembler    Page 7 


   79 00000030         
   91 00000030         
   92 00000030         vPortYield
   93 00000030         
   94 00000030                 PRESERVE8
   95 00000030         
   96 00000030 EF000000        SVC              0
   97 00000034 E12FFF1E        bx               lr
   98 00000038         
   99 00000038         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;
  100 00000038         ; Interrupt service routine for the SWI interrupt.  The 
                       vector table is
  101 00000038         ; configured in the startup.s file.
  102 00000038         ;
  103 00000038         ; vPortYieldProcessor() is used to manually force a cont
                       ext switch.  The
  104 00000038         ; SWI interrupt is generated by a call to taskYIELD() or
                        portYIELD().
  105 00000038         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;
  106 00000038         
  107 00000038         vPortYieldProcessor
  108 00000038         
  109 00000038                 PRESERVE8
  110 00000038         
  111 00000038         ; Within an IRQ ISR the link register has an offset from
                        the true return 
  112 00000038         ; address, but an SWI ISR does not.  Add the offset manu
                       ally so the same 
  113 00000038         ; ISR return code can be used in both cases.
  114 00000038 E28EE004        ADD              LR, LR, #4
  115 0000003C         
  116 0000003C         ; Perform the context switch.
  117 0000003C                 portSAVE_CONTEXT             ; Save current task
                                                             context    
   86 0000003C         
   87 0000003C E92D0001        STMDB            SP!, {R0}   ; Store R0 first as
                                                             we need to use it.
                                                            
   88 00000040         
   89 00000040 E94D2000        STMDB            SP,{SP}^    ; Set R0 to point t
                                                            o the task stack po
                                                            inter.
   90 00000044 E1A00000        NOP                          ;
   91 00000048 E24DD004        SUB              SP, SP, #4  ;
   92 0000004C E8BD0001        LDMIA            SP!,{R0}    ;
   93 00000050         
   94 00000050 E9204000        STMDB            R0!, {LR}   ; Push the return a
                                                            ddress onto the sta
                                                            ck.
   95 00000054 E1A0E000        MOV              LR, R0      ; Now we have saved
                                                             LR we can use it i
                                                            nstead of R0.
   96 00000058 E8BD0001        LDMIA            SP!, {R0}   ; Pop R0 so we can 
                                                            save it onto the sy
                                                            stem mode stack.
   97 0000005C         
   98 0000005C E94E7FFF        STMDB            LR,{R0-LR}^ ; Push all the syst



ARM Macro Assembler    Page 8 


                                                            em mode registers o
                                                            nto the task stack.
                                                            
   99 00000060 E1A00000        NOP                          ;
  100 00000064 E24EE03C        SUB              LR, LR, #60 ;
  101 00000068         
  102 00000068 E14F0000        MRS              R0, SPSR    ; Push the SPSR ont
                                                            o the task stack.
  103 0000006C E92E0001        STMDB            LR!, {R0}   ;
  104 00000070         
  105 00000070 E59F01A4        LDR              R0, =ulCriticalNesting ;
  106 00000074 E5900000        LDR              R0, [R0]    ;
  107 00000078 E92E0001        STMDB            LR!, {R0}   ;
  108 0000007C         
  109 0000007C E59F0194        LDR              R0, =pxCurrentTCB ; Store the n
                                                            ew top of stack for
                                                             the task.
  110 00000080 E5901000        LDR              R1, [R0]    ;    
  111 00000084 E581E000        STR              LR, [R1]    ;
  112 00000088         
  118 00000088 E59F0190        LDR              R0, =vTaskSwitchContext ; Get t
                                                            he address of the c
                                                            ontext switch funct
                                                            ion
  119 0000008C E1A0E00F        MOV              LR, PC      ; Store the return 
                                                            address
  120 00000090 E12FFF10        BX               R0          ; Call the contedxt
                                                             switch function
  121 00000094                 portRESTORE_CONTEXT          ; restore the conte
                                                            xt of the selected 
                                                            task 
   60 00000094         
   61 00000094 E59F017C        LDR              R0, =pxCurrentTCB ; Set the LR 
                                                            to the task stack. 
                                                             The location was..
                                                            .
   62 00000098 E5900000        LDR              R0, [R0]    ; ... stored in pxC
                                                            urrentTCB
   63 0000009C E590E000        LDR              LR, [R0]
   64 000000A0         
   65 000000A0 E59F0174        LDR              R0, =ulCriticalNesting ; The cr
                                                            itical nesting dept
                                                            h is the first item
                                                             on... 
   66 000000A4 E8BE0002        LDMFD            LR!, {R1}   ; ...the stack.  Lo
                                                            ad it into the ulCr
                                                            iticalNesting var.
   67 000000A8 E5801000        STR              R1, [R0]    ;
   68 000000AC         
   69 000000AC E8BE0001        LDMFD            LR!, {R0}   ; Get the SPSR from
                                                             the stack.
   70 000000B0 E16FF000        MSR              SPSR_cxsf, R0 ;
   71 000000B4         
   72 000000B4 E8DE7FFF        LDMFD            LR, {R0-R14}^ ; Restore all sys
                                                            tem mode registers 
                                                            for the task.
   73 000000B8 E1A00000        NOP                          ;
   74 000000BC         
   75 000000BC E59EE03C        LDR              LR, [LR, #+60] ; Restore the re



ARM Macro Assembler    Page 9 


                                                            turn address
   76 000000C0         
   77 000000C0         ; And return - correcting the offset in the LR to obtain
                        ...
   78 000000C0 E25EF004        SUBS             PC, LR, #4  ; ...the correct ad
                                                            dress.
   79 000000C4         
  122 000000C4         
  123 000000C4         
  124 000000C4         
  125 000000C4         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;;
  126 000000C4         ; Interrupt service routine for preemptive scheduler tic
                       k timer
  127 000000C4         ; Only used if portUSE_PREEMPTION is set to 1 in portmac
                       ro.h
  128 000000C4         ;
  129 000000C4         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;; 
  130 000000C4         
  131 000000C4         vPreemptiveTick
  132 000000C4         
  133 000000C4                 PRESERVE8
  134 000000C4         
  135 000000C4                 portSAVE_CONTEXT             ; Save the context 
                                                            of the current task
                                                            . 
   86 000000C4         
   87 000000C4 E92D0001        STMDB            SP!, {R0}   ; Store R0 first as
                                                             we need to use it.
                                                            
   88 000000C8         
   89 000000C8 E94D2000        STMDB            SP,{SP}^    ; Set R0 to point t
                                                            o the task stack po
                                                            inter.
   90 000000CC E1A00000        NOP                          ;
   91 000000D0 E24DD004        SUB              SP, SP, #4  ;
   92 000000D4 E8BD0001        LDMIA            SP!,{R0}    ;
   93 000000D8         
   94 000000D8 E9204000        STMDB            R0!, {LR}   ; Push the return a
                                                            ddress onto the sta
                                                            ck.
   95 000000DC E1A0E000        MOV              LR, R0      ; Now we have saved
                                                             LR we can use it i
                                                            nstead of R0.
   96 000000E0 E8BD0001        LDMIA            SP!, {R0}   ; Pop R0 so we can 
                                                            save it onto the sy
                                                            stem mode stack.
   97 000000E4         
   98 000000E4 E94E7FFF        STMDB            LR,{R0-LR}^ ; Push all the syst
                                                            em mode registers o
                                                            nto the task stack.
                                                            
   99 000000E8 E1A00000        NOP                          ;
  100 000000EC E24EE03C        SUB              LR, LR, #60 ;
  101 000000F0         
  102 000000F0 E14F0000        MRS              R0, SPSR    ; Push the SPSR ont
                                                            o the task stack.
  103 000000F4 E92E0001        STMDB            LR!, {R0}   ;



ARM Macro Assembler    Page 10 


  104 000000F8         
  105 000000F8 E59F011C        LDR              R0, =ulCriticalNesting ;
  106 000000FC E5900000        LDR              R0, [R0]    ;
  107 00000100 E92E0001        STMDB            LR!, {R0}   ;
  108 00000104         
  109 00000104 E59F010C        LDR              R0, =pxCurrentTCB ; Store the n
                                                            ew top of stack for
                                                             the task.
  110 00000108 E5901000        LDR              R1, [R0]    ;    
  111 0000010C E581E000        STR              LR, [R1]    ;
  112 00000110         
  136 00000110         
  137 00000110 E59F010C        LDR              R0, =vTaskIncrementTick ; Incre
                                                            ment the tick count
                                                            .  
  138 00000114 E1A0E00F        MOV              LR, PC      ; This may make a d
                                                            elayed task ready
  139 00000118 E12FFF10        BX               R0          ; to run.
  140 0000011C         
  141 0000011C E59F00FC        LDR              R0, =vTaskSwitchContext ; Find 
                                                            the highest priorit
                                                            y task that 
  142 00000120 E1A0E00F        MOV              LR, PC      ; is ready to run.
  143 00000124 E12FFF10        BX               R0
  144 00000128         
  145 00000128         ; MOV R0, #T0MATCHBIT     ; Clear the timer event
  146 00000128         ; LDR R1, =T0IR
  147 00000128         ; STR R0, [R1] 
  148 00000128         
  149 00000128         ; LDR R0, =VICVECTADDR    ; Acknowledge the interrupt 
  150 00000128         ; STR R0,[R0]
  151 00000128         
  152 00000128                 portRESTORE_CONTEXT          ; Restore the conte
                                                            xt of the highest 
   60 00000128         
   61 00000128 E59F00E8        LDR              R0, =pxCurrentTCB ; Set the LR 
                                                            to the task stack. 
                                                             The location was..
                                                            .
   62 0000012C E5900000        LDR              R0, [R0]    ; ... stored in pxC
                                                            urrentTCB
   63 00000130 E590E000        LDR              LR, [R0]
   64 00000134         
   65 00000134 E59F00E0        LDR              R0, =ulCriticalNesting ; The cr
                                                            itical nesting dept
                                                            h is the first item
                                                             on... 
   66 00000138 E8BE0002        LDMFD            LR!, {R1}   ; ...the stack.  Lo
                                                            ad it into the ulCr
                                                            iticalNesting var.
   67 0000013C E5801000        STR              R1, [R0]    ;
   68 00000140         
   69 00000140 E8BE0001        LDMFD            LR!, {R0}   ; Get the SPSR from
                                                             the stack.
   70 00000144 E16FF000        MSR              SPSR_cxsf, R0 ;
   71 00000148         
   72 00000148 E8DE7FFF        LDMFD            LR, {R0-R14}^ ; Restore all sys
                                                            tem mode registers 
                                                            for the task.



ARM Macro Assembler    Page 11 


   73 0000014C E1A00000        NOP                          ;
   74 00000150         
   75 00000150 E59EE03C        LDR              LR, [LR, #+60] ; Restore the re
                                                            turn address
   76 00000154         
   77 00000154         ; And return - correcting the offset in the LR to obtain
                        ...
   78 00000154 E25EF004        SUBS             PC, LR, #4  ; ...the correct ad
                                                            dress.
   79 00000158         
  153 00000158         ; priority task that is ready to run.
  154 00000158         
  155 00000158         
  156 00000158         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;;
  157 00000158         ; IRQ handler
  158 00000158         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;;
  159 00000158         freeRtosirqHandler
  160 00000158                 PRESERVE8
  161 00000158                 portSAVE_CONTEXT             ; Save the context 
                                                            of the current task
                                                            ...
   86 00000158         
   87 00000158 E92D0001        STMDB            SP!, {R0}   ; Store R0 first as
                                                             we need to use it.
                                                            
   88 0000015C         
   89 0000015C E94D2000        STMDB            SP,{SP}^    ; Set R0 to point t
                                                            o the task stack po
                                                            inter.
   90 00000160 E1A00000        NOP                          ;
   91 00000164 E24DD004        SUB              SP, SP, #4  ;
   92 00000168 E8BD0001        LDMIA            SP!,{R0}    ;
   93 0000016C         
   94 0000016C E9204000        STMDB            R0!, {LR}   ; Push the return a
                                                            ddress onto the sta
                                                            ck.
   95 00000170 E1A0E000        MOV              LR, R0      ; Now we have saved
                                                             LR we can use it i
                                                            nstead of R0.
   96 00000174 E8BD0001        LDMIA            SP!, {R0}   ; Pop R0 so we can 
                                                            save it onto the sy
                                                            stem mode stack.
   97 00000178         
   98 00000178 E94E7FFF        STMDB            LR,{R0-LR}^ ; Push all the syst
                                                            em mode registers o
                                                            nto the task stack.
                                                            
   99 0000017C E1A00000        NOP                          ;
  100 00000180 E24EE03C        SUB              LR, LR, #60 ;
  101 00000184         
  102 00000184 E14F0000        MRS              R0, SPSR    ; Push the SPSR ont
                                                            o the task stack.
  103 00000188 E92E0001        STMDB            LR!, {R0}   ;
  104 0000018C         
  105 0000018C E59F0088        LDR              R0, =ulCriticalNesting ;
  106 00000190 E5900000        LDR              R0, [R0]    ;
  107 00000194 E92E0001        STMDB            LR!, {R0}   ;



ARM Macro Assembler    Page 12 


  108 00000198         
  109 00000198 E59F0078        LDR              R0, =pxCurrentTCB ; Store the n
                                                            ew top of stack for
                                                             the task.
  110 0000019C E5901000        LDR              R1, [R0]    ;    
  111 000001A0 E581E000        STR              LR, [R1]    ;
  112 000001A4         
  162 000001A4         
  163 000001A4 EBFFFFFE        BL               freeRtos_irq_isr_handler
  164 000001A8         
  165 000001A8                 portRESTORE_CONTEXT          ; Restore the conte
                                                            xt of the selected 
                                                            task.
   60 000001A8         
   61 000001A8 E59F0068        LDR              R0, =pxCurrentTCB ; Set the LR 
                                                            to the task stack. 
                                                             The location was..
                                                            .
   62 000001AC E5900000        LDR              R0, [R0]    ; ... stored in pxC
                                                            urrentTCB
   63 000001B0 E590E000        LDR              LR, [R0]
   64 000001B4         
   65 000001B4 E59F0060        LDR              R0, =ulCriticalNesting ; The cr
                                                            itical nesting dept
                                                            h is the first item
                                                             on... 
   66 000001B8 E8BE0002        LDMFD            LR!, {R1}   ; ...the stack.  Lo
                                                            ad it into the ulCr
                                                            iticalNesting var.
   67 000001BC E5801000        STR              R1, [R0]    ;
   68 000001C0         
   69 000001C0 E8BE0001        LDMFD            LR!, {R0}   ; Get the SPSR from
                                                             the stack.
   70 000001C4 E16FF000        MSR              SPSR_cxsf, R0 ;
   71 000001C8         
   72 000001C8 E8DE7FFF        LDMFD            LR, {R0-R14}^ ; Restore all sys
                                                            tem mode registers 
                                                            for the task.
   73 000001CC E1A00000        NOP                          ;
   74 000001D0         
   75 000001D0 E59EE03C        LDR              LR, [LR, #+60] ; Restore the re
                                                            turn address
   76 000001D4         
   77 000001D4         ; And return - correcting the offset in the LR to obtain
                        ...
   78 000001D4 E25EF004        SUBS             PC, LR, #4  ; ...the correct ad
                                                            dress.
   79 000001D8         
  166 000001D8         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;;
  167 000001D8         
  168 000001D8         portDISABLE_INTERRUPTS
  169 000001D8                 PRESERVE8
  170 000001D8 E92D0001        STMDB            SP!,{R0}
  171 000001DC         REDISABLE
  172 000001DC E10F0000        MRS              R0,CPSR
  173 000001E0 E38000C0        ORR              R0,R0,#0xc0
  174 000001E4 E12FF000        MSR              CPSR_cxsf,R0
  175 000001E8 E10F0000        MRS              R0,CPSR



ARM Macro Assembler    Page 13 


  176 000001EC E20000C0        AND              R0,R0,#0xc0
  177 000001F0 E35000C0        CMP              R0,#0xc0
  178 000001F4 1AFFFFF8        BNE              REDISABLE
  179 000001F8 E8BD0001        LDMIA            SP!,{R0}
  180 000001FC E12FFF1E        BX               LR
  181 00000200         
  182 00000200         portENABLE_INTERRUPTS
  183 00000200                 PRESERVE8
  184 00000200 E92D0001        STMDB            SP!,{R0}
  185 00000204 E10F0000        MRS              R0,CPSR
  186 00000208 E3C000C0        BIC              R0,R0,#0xc0
  187 0000020C E12FF000        MSR              CPSR_cxsf,R0
  188 00000210 E8BD0001        LDMIA            SP!,{R0}
  189 00000214 E12FFF1E        BX               LR
  190 00000218         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
  191 00000218                 ENDIF
  192 00000218                 END
              00000000 
              00000000 
              00000000 
              00000000 
Command Line: --xref --cpu=ARM966E-S --apcs=interwork --depend=.\objs\portasm.d
 -o.\objs\portasm.o -I..\..\..\Include -I..\..\..\Src\OS\RTOS\include -Id:\Keil
_v4\ARM\RV31\INC -Id:\Keil_v4\ARM\CMSIS\Include --list=.\portasm.lst ..\..\..\S
rc\OS\RTOS\ports\portASM.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

PORT_ASM 00000000

Symbol: PORT_ASM
   Definitions
      At line 78 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      None
Comment: PORT_ASM unused
REDISABLE 000001DC

Symbol: REDISABLE
   Definitions
      At line 171 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 178 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: REDISABLE used once
freeRtosirqHandler 00000158

Symbol: freeRtosirqHandler
   Definitions
      At line 159 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 65 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: freeRtosirqHandler used once
portDISABLE_INTERRUPTS 000001D8

Symbol: portDISABLE_INTERRUPTS
   Definitions
      At line 168 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 66 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: portDISABLE_INTERRUPTS used once
portENABLE_INTERRUPTS 00000200

Symbol: portENABLE_INTERRUPTS
   Definitions
      At line 182 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 67 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: portENABLE_INTERRUPTS used once
vPortStartFirstTask 00000000

Symbol: vPortStartFirstTask
   Definitions
      At line 86 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 62 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: vPortStartFirstTask used once
vPortYield 00000030

Symbol: vPortYield
   Definitions
      At line 92 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 64 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: vPortYield used once
vPortYieldProcessor 00000038

Symbol: vPortYieldProcessor



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 107 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 61 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: vPortYieldProcessor used once
vPreemptiveTick 000000C4

Symbol: vPreemptiveTick
   Definitions
      At line 131 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 63 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: vPreemptiveTick used once
9 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

T0IR E0004000

Symbol: T0IR
   Definitions
      At line 74 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      None
Comment: T0IR unused
T0MATCHBIT 00000001

Symbol: T0MATCHBIT
   Definitions
      At line 75 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      None
Comment: T0MATCHBIT unused
VICVECTADDR FFFFF030

Symbol: VICVECTADDR
   Definitions
      At line 73 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      None
Comment: VICVECTADDR unused
__TLS_OS_FREERTOS 00000001

Symbol: __TLS_OS_FREERTOS
   Definitions
      At line 2 in file ..\..\..\Include\wm_config.inc
   Uses
      None
Comment: __TLS_OS_FREERTOS unused
4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

freeRtos_irq_isr_handler 00000000

Symbol: freeRtos_irq_isr_handler
   Definitions
      At line 59 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 163 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: freeRtos_irq_isr_handler used once
pxCurrentTCB 00000000

Symbol: pxCurrentTCB
   Definitions
      At line 55 in file ..\..\..\Src\OS\RTOS\include\portmacro.inc
   Uses
      At line 61 in macro ÿÿ¶HC¶`C¶xC¶C¶
      at line 90 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
      At line 109 in macro )¶TEXT
      at line 117 in file ..\..\..\Src\OS\RTOS\ports\portASM.s

ulCriticalNesting 00000000

Symbol: ulCriticalNesting
   Definitions
      At line 54 in file ..\..\..\Src\OS\RTOS\include\portmacro.inc
   Uses
      At line 65 in macro ÿÿ¶HC¶`C¶xC¶C¶
      at line 90 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
      At line 105 in macro )¶TEXT
      at line 117 in file ..\..\..\Src\OS\RTOS\ports\portASM.s

vTaskIncrementTick 00000000

Symbol: vTaskIncrementTick
   Definitions
      At line 58 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 137 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
Comment: vTaskIncrementTick used once
vTaskSwitchContext 00000000

Symbol: vTaskSwitchContext
   Definitions
      At line 57 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
   Uses
      At line 118 in file ..\..\..\Src\OS\RTOS\ports\portASM.s
      At line 141 in file ..\..\..\Src\OS\RTOS\ports\portASM.s

5 symbols
350 symbols in table
